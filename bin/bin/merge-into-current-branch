#!/bin/bash
set -eEoux pipefail

ORIGINAL_BRANCH="$(git rev-parse --abbrev-ref HEAD)"

git add --all
git diff --quiet || git stash; CHANGES_WERE_STASHED=true
git checkout $BRANCH_TO_MERGE
git pull --ff-only --rebase
git checkout $ORIGINAL_BRANCH
git merge $BRANCH_TO_MERGE --no-edit
[[ -z $CHANGES_WERE_STASHED ]] || git stash apply
